<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css" />
</head>
<body>

<div id="username-page">
    <div class="username-page-container">
        <form id="usernameForm" name="usernameForm" th:object="${user}">
            <div class="form-group">
                <input type="text" id="name" th:value="${user.name}" autocomplete="off" class="hidden form-control" />
            </div>
            <div class="form-group">
                <input type="text" id="userID" th:value="${user.userID}" autocomplete="off" class="hidden form-control" />
            </div>
            <select id="room" name="room" class="form-control" >
                <option th:each="room: ${rooms}"
                        th:value="${room.roomID} + '-' + ${room.createdByUserID}"
                        th:text="${room.roomName}">
                </option>
            </select>
            <div class="form-group">
                <button type="submit" id="username-submit-button" class="accent username-submit">Start Chatting</button>
            </div>
        </form>
    </div>
</div>

<div id="chat-page" class="hidden">
    <div class="chat-container">
        <div class="chat-header">
            <h2>Spring WebSocket Chat Demo</h2>
        </div>
        <div class="modal fade" id="modelWindow" role="dialog">
            <div class="modal-dialog modal-sm vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Select user</h4>
                    </div>
                    <div class="modal-body">
                        <form id="inviteMessageForm" name="inviteMessageForm"  method="post" th:action="@{'/users/' + ${user.userID} + '/chat/rooms/invite'}">
                            <div class="form-group">
                                    <label for="inviteUserID">Choose user</label>
                                    <select id="inviteUserID" name="inviteUserID" class="form-control" >
                                        <option th:each="user: ${users}"
                                                th:value="${user.userID}"
                                                th:text="${user.name}">
                                        </option>
                                    </select>
                            </div>
                            <div class="form-group">
                                    <label for="inviteRoomID">Choose room</label>
                                    <select id="inviteRoomID" name="inviteRoomID" class="form-control" >
                                        <option th:each="chatRoom: ${rooms}"
                                                th:value="${chatRoom.roomID}"
                                                th:text="${chatRoom.roomName}">
                                        </option>
                                    </select>
                            </div>
                            <div class="form-group">
                                <button type="submit"  class="primary">Invite</button>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" data-dismiss="modal" class="btn btn-default">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="connecting">
            Connecting...
        </div>
        <ul id="messageArea">

        </ul>
        <form id="messageForm" name="messageForm">
            <div class="form-group">
                <div class="input-group clearfix">
                    <input type="text" id="message" placeholder="Type a message..." autocomplete="off" class="form-control"/>
                    <button type="submit"  class="primary">Send</button>
                </div>
            </div>
        </form>

        <a th:href="@{'/users/' + ${user.userID} + '/chat/rooms/change'}" class="btn btn-lg btn-warning btn-block">Choose room</a>

        <form id="roomForm" name="roomForm" method="post" th:action="@{'/users/' + ${user.userID} + '/chat/rooms/create'}" th:object="${chatRoom}" style="padding-top: 10px;">
            <div class="form-group">
                <div class="input-group clearfix">
                    <input type="text" id="roomName"  th:field="*{roomName}" placeholder="Add room "  class="form-control"/>
                    <button type="submit" id="roomForm-submit-button" class="primary">Create room</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/

    var rooms = [[${rooms}]];

    /*]]>*/
</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>